<th:block xmlns:th="http://www.thymeleaf.org"
          xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
          th:fragment="reply(node, depth, postId,userId)">

<style>
            /* ëŒ“ê¸€ ì»¨í…Œì´ë„ˆ */
            .reply-header {
              display: flex;
              justify-content: space-between;
              align-items: center;
              font-size: 14px;
              margin-bottom: 8px;
              border-bottom: 1px solid #f1f1f1;
              padding-bottom: 8px;
            }

            .reply-header a {
              color: #007bff;
              text-decoration: none;

            }

            .reply-header a:hover {
              text-decoration: underline;
            }

            .reply-header button {
              background-color: #007bff;
              color: white;
              padding: 5px 10px;
              font-size: 12px;
              border: none;
              border-radius: 4px;
              cursor: pointer;
              transition: background-color 0.3s ease;
            }

            .reply-header button:hover {
              background-color: #0056b3;
            }

            .reply-content {
              font-size: 16px;
              line-height: 1.6;
              margin-bottom: 12px;
              color: #333;
              /* font-weight: bold; */ /* Remove bold styling */
            }

            /* ëŒ€ëŒ“ê¸€ ìŠ¤íƒ€ì¼ (ë“¤ì—¬ì“°ê¸°) */
            .reply-content {
              margin-left: 20px;
              padding-left: 10px;
              border-left: 2px solid #ccc;
            }

            /* ëª¨ë‹¬ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
            .my-modal {
              display: none;
              position: fixed;
              top: 50%;
              left: 50%;
              transform: translate(-50%, -50%);
              background: white;
              padding: 20px;
              border-radius: 8px;
              box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
              z-index: 1000;
              width: 400px;
              max-width: 90%;
              box-sizing: border-box;
            }

            /* ëª¨ë‹¬ ë°°ê²½ */
            #modalBackdrop {
              display: none;
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: rgba(0, 0, 0, 0.5);
              z-index: 999;
            }

            .modal h3 {
              font-size: 18px;
              margin-bottom: 12px;
            }

            .modal textarea {
              width: 100%;
              padding: 10px;
              font-size: 14px;
              margin-bottom: 20px;
              border: 1px solid #ccc;
              border-radius: 4px;
              box-sizing: border-box;
              resize: none;
            }

            .modal button {
              background-color: #007bff;
              color: white;
              padding: 8px 16px;
              font-size: 14px;
              border: none;
              border-radius: 4px;
              cursor: pointer;
              transition: background-color 0.3s ease;
            }

            .modal button:hover {
              background-color: #0056b3;
            }

            .modal button[type="button"] {
              background-color: #ccc;
            }

            .modal button[type="button"]:hover {
              background-color: #999;
            }

            /* ëŒ€ëŒ“ê¸€ ì‘ì„± í¼ */
            form input[type="text"] {
              width: 100%;
              padding: 10px;
              font-size: 14px;
              border: 1px solid #ccc;
              border-radius: 4px;
              margin-bottom: 10px;
              box-sizing: border-box;
            }

            form button {
              background-color: #28a745;
              color: white;
              padding: 8px 16px;
              font-size: 14px;
              border: none;
              border-radius: 4px;
              cursor: pointer;
              transition: background-color 0.3s ease;
            }

            form button:hover {
              background-color: #218838;
            }
          </style>
  <div th:style="'margin-left:' + (${depth} * 40) + 'px'">

    <!-- 1) ë©”íƒ€ ì •ë³´ (í—¤ë”) -->
    <div class="reply-header">
      <strong>
        <a th:href="@{/user/{userId}(userId=${node.reply.userId})}"
           th:text="${node.reply.username}">ì‘ì„±ì</a>
      </strong>
      <a>
        <span th:text="${#temporals.format(node.reply.created_at,'yyyy-MM-dd HH:mm')}">ë‚ ì§œ</span>
      </a>
      <button th:if="${session.user != null and node.reply.email != session.user.email}" type="button"
              th:onclick="'openReportModal(' + ${node.reply.id} + ')'">
        ì‹ ê³ 
      </button>

      <th:block th:if="${session.user != null and node.reply.email == session.user.email}">
        <button type="button"
                th:onclick="'openEditModal(' + ${node.reply.id} + ')'">
          ìˆ˜ì •
        </button>
        <button type="button"
                th:onclick="'openDeleteModal(' + ${node.reply.id} + ')'">
          ì‚­ì œ
        </button>
      </th:block>
    </div>

    <!-- 2) ëŒ“ê¸€ ë³¸ë¬¸ -->
    <div class="reply-content">
      <p th:text="${node.reply.content}">ëŒ“ê¸€ ë‚´ìš©</p>
    </div>

    <!-- 3) ì‹ ê³  ëª¨ë‹¬ -->
    <div th:id="'reportModal-' + ${node.reply.id}" class="my-modal">
      <form th:action="@{/report/{postId}/{userId}(postId=${postId},userId=${node.reply.userId})}" method="post">
        <h5 class="mb-3">ğŸš¨ ì‹ ê³  ì‚¬ìœ  ì…ë ¥</h5>
        <textarea name="reason" rows="4" class="form-control mb-3" placeholder="ì‹ ê³  ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”." required></textarea>
        <div class="d-flex justify-content-end gap-2">
          <button type="submit" class="btn btn-danger">ì œì¶œ</button>
          <button type="button" th:onclick="'closeModal(\'reportModal-' + ${node.reply.id} + '\')'">ì·¨ì†Œ</button>
        </div>
      </form>
    </div>

    <!-- 4) ìˆ˜ì • ëª¨ë‹¬ -->
    <div th:id="'editModal-' + ${node.reply.id}" class="my-modal">
      <form th:action="@{/reply/edit/{replyId}(replyId=${node.reply.id})}" method="post">
        <h3>ëŒ“ê¸€ ìˆ˜ì •</h3>
        <textarea name="content" rows="3" cols="40" th:text="${node.reply.content}" required></textarea><br><br>
        <button type="submit">ìˆ˜ì •ì™„ë£Œ</button>
        <button type="button" th:onclick="'closeModal(\'editModal-' + ${node.reply.id} + '\')'">ì·¨ì†Œ</button>
      </form>
    </div>

    <!-- 5) ì‚­ì œ ëª¨ë‹¬ -->
    <div th:id="'deleteModal-' + ${node.reply.id}" class="my-modal">
      <p>ì •ë§ ì´ ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
      <form th:action="@{/reply/delete/{replyId}(replyId=${node.reply.id})}" method="post">
        <button type="submit">ì‚­ì œ</button>
        <button type="button" th:onclick="'closeModal(\'deleteModal-' + ${node.reply.id} + '\')'">ì·¨ì†Œ</button>
      </form>
    </div>

    <!-- 6) ëŒ€ëŒ“ê¸€ ì…ë ¥ í¼ -->
    <form th:action="@{/reply/{postId}/{parentReplyId}(postId=${postId}, parentReplyId=${node.reply.id})}" method="post">
      <input type="text" name="content" placeholder="ëŒ€ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”" required />
      <button type="submit">ë‹µê¸€</button>
    </form>

  </div>

  <!-- ìì‹ ëŒ“ê¸€ ì¬ê·€ í˜¸ì¶œ -->
  <th:block th:if="${node.children}" th:each="child : ${node.children}">
    <div th:replace="~{replyNode :: reply(${child}, ${depth + 1}, ${postId},${userId})}"></div>
  </th:block>
</th:block>

